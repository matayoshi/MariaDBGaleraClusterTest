---
- name: add MariaDB repo
  copy: >
    src="files/db/yum/repos/MariaDB.repo"
    dest="/etc/yum.repos.d/MariaDB.repo"
    backup="yes"
    mode="0644"
    owner="root"
    group="root"
- name: apply mariadb conf files
  copy: >
    src="files/db/mariadb/conf/{{ item }}"
    dest="/etc/{{ item }}"
    backup="yes"
    mode="0644"
    owner="root"
    group="root"
  with_items:
    - my.cnf
    - my.cnf.d/client.cnf
    - my.cnf.d/mysql-clients.cnf
    - my.cnf.d/tokudb.cnf
- name: apply mariadb my.cnf.d/server.cnf
  template: >
    src="files/db/mariadb/conf/my.cnf.d/server.cnf"
    dest="/etc/my.cnf.d/server.cnf"
    backup="yes"
    mode="0644"
    owner="root"
    group="root"
- name: install MariaDB Galera Cluster
  yum:
  yum: name={{ item }} state=present
  with_items:
    - MariaDB-Galera-server
    - MariaDB-client
    - galera
- name: disable MariaDB(no autostart)
  service: >
    name="mysql"
    enabled="no"
